---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.1'
      jupytext_version: 1.1.1
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

# Using to query SQL

```{python}
from sqlalchemy import create_engine
from siuba.data import mtcars
import pandas as pd

engine = create_engine('sqlite:///:memory:', echo=False)

# note that mtcars is a pandas DataFrame
mtcars.to_sql('mtcars', engine)
```

```{python}
from siuba import *
from siuba.sql import LazyTbl, show_query, collect

tbl_mtcars = LazyTbl(engine, 'mtcars')
```

```{python}
tbl_mtcars
```

```{python}
tbl_mtcars >> filter(_.hp > 250) >> collect()
```

```{python}
(tbl_mtcars
  >> group_by(_.cyl)
  >> summarize(avg_mpg = _.mpg.mean())
  >> collect()
  )
```
